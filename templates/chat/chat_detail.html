{% extends 'base.html' %}
{% block title %}–ß–∞—Ç ‚Äî {{ chat.vet.username }}{% endblock %}

{% block content %}
<div class="card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h1>
      üí¨ –ß–∞—Ç —Å 
      {% if user == chat.owner %}
        {{ chat.vet.get_full_name|default:chat.vet.username }} ({{ chat.clinic.name }})
      {% else %}
        {{ chat.owner.get_full_name|default:chat.owner.username }}
      {% endif %}
    </h1>
    <a href="{% url 'chat:chat_list' %}" class="btn" style="background: #6c757d; padding: 6px 12px; font-size: 0.9rem;">‚Üê –í—Å–µ —á–∞—Ç—ã</a>
  </div>

  <div style="height: 400px; overflow-y: auto; border: 1px solid #e1e5eb; border-radius: var(--radius); padding: 1rem; margin-bottom: 1.5rem; background: #fcfdff;">
    {% for msg in messages %}
      <div style="margin-bottom: 1rem;">
        <div style="font-weight: 600; color: {% if msg.sender == user %}var(--primary){% else %}var(--gray){% endif %};">
          {{ msg.sender.get_full_name|default:msg.sender.username }} 
          <span style="font-weight: normal; font-size: 0.85rem; color: #999;">{{ msg.timestamp|date:"H:i" }}</span>
        </div>
        <div style="margin-top: 0.3rem;">{{ msg.text|linebreaks }}</div>
      </div>
    {% empty %}
      <p style="color: var(--gray); text-align: center;">–ß–∞—Ç –ø—É—Å—Ç. –ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!</p>
    {% endfor %}
  </div>

  <form method="post">
    {% csrf_token %}
    <div class="input-group">
      <textarea name="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="min-height: 80px; resize: vertical;" required></textarea>
      <label for="id_text">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
    </div>
    <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>
</div>

<script>
  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
  const chatBox = document.querySelector('div[style*="height: 400px"]');
  if (chatBox) {
    chatBox.scrollTop = chatBox.scrollHeight;
  }
</script>
{% endblock %}